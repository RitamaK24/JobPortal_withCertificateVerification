<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificate Portal - Verify & Download</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); padding: 20px; border-radius: 15px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; }
        .logo { color: white; font-size: 28px; font-weight: 700; }
        .nav { display: flex; gap: 15px; }
        .nav a { color: white; text-decoration: none; padding: 10px 20px; border-radius: 8px; transition: 0.3s; }
        .nav a:hover { background: rgba(255,255,255,0.2); }
        .hero { text-align: center; color: white; padding: 60px 20px; }
        .hero h1 { font-size: 48px; margin-bottom: 15px; }
        .hero p { font-size: 20px; opacity: 0.9; }
        .search-box { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); max-width: 600px; margin: 0 auto; }
        .search-box h2 { color: #333; margin-bottom: 10px; }
        .search-box p { color: #666; margin-bottom: 30px; }
        .search-form { display: flex; gap: 10px; }
        .search-form input { flex: 1; padding: 15px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 16px; }
        .search-form button { padding: 15px 30px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; transition: 0.3s; }
        .search-form button:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(102,126,234,0.4); }
        .cert-result { background: white; padding: 50px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); max-width: 900px; margin: 30px auto; display: none; }
        .cert-header { text-align: center; margin-bottom: 40px; }
        .cert-header h2 { color: #10b981; font-size: 32px; margin-bottom: 20px; }
        .download-btn { padding: 15px 40px; background: #10b981; color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; font-size: 16px; }
        .cert-preview { border: 4px solid #667eea; border-radius: 15px; padding: 50px; background: linear-gradient(135deg, #ffffff 0%, #f5f7fa 100%); position: relative; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .cert-preview::before { content: ''; position: absolute; top: 10px; left: 10px; right: 10px; bottom: 10px; border: 2px solid #D4AF37; border-radius: 10px; pointer-events: none; }
        .cert-preview::after { content: ''; position: absolute; top: 20px; left: 20px; right: 20px; bottom: 20px; border: 1px solid #e5e7eb; border-radius: 8px; pointer-events: none; }
        .cert-badge { width: 100px; height: 100px; background: linear-gradient(135deg, #1e3a8a, #3b82f6); border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 50px; color: white; box-shadow: 0 8px 20px rgba(30,58,138,0.4); border: 5px solid #D4AF37; }
        .cert-title { font-size: 48px; color: #1e3a8a; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 4px; font-weight: 800; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }
        .cert-subtitle { font-size: 26px; color: #D4AF37; margin-bottom: 30px; letter-spacing: 3px; font-weight: 600; }
        .cert-text { font-size: 18px; color: #555; margin: 15px 0; line-height: 1.6; }
        .cert-name { font-size: 38px; color: #764ba2; font-weight: 800; margin: 25px 0; text-transform: uppercase; letter-spacing: 2px; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
        .cert-domain { font-size: 32px; color: #667eea; font-weight: 700; margin: 25px 0; letter-spacing: 1px; }
        .cert-details { margin-top: 50px; padding-top: 30px; border-top: 3px solid #D4AF37; display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .cert-details p { font-size: 16px; color: #333; line-height: 1.8; }
        .cert-details strong { color: #1e3a8a; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
        .cert-footer { margin-top: 40px; display: flex; justify-content: space-between; align-items: center; padding-top: 30px; border-top: 2px solid #e5e7eb; }
        .signature-box { text-align: center; }
        .signature-line { width: 200px; height: 2px; background: #333; margin: 10px auto; }
        .signature-text { font-size: 14px; color: #666; margin-top: 5px; }
        .cert-seal { width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #D4AF37, #FFD700); display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; color: #1e3a8a; border: 3px solid #1e3a8a; box-shadow: 0 4px 12px rgba(212,175,55,0.4); }
        .qr-code { width: 100px; height: 100px; background: white; border: 2px solid #333; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #666; }
        .watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-45deg); font-size: 120px; color: rgba(102,126,234,0.05); font-weight: 900; pointer-events: none; z-index: 0; }
        .cert-content { position: relative; z-index: 1; }
        .error-box { background: white; padding: 40px; border-radius: 20px; max-width: 600px; margin: 30px auto; text-align: center; display: none; }
        .error-box h3 { color: #dc2626; font-size: 28px; margin-bottom: 15px; }
        .features { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 50px; }
        .feature-card { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); padding: 30px; border-radius: 15px; text-align: center; color: white; transition: 0.3s; }
        .feature-card:hover { transform: translateY(-5px); background: rgba(255,255,255,0.15); }
        .feature-icon { font-size: 48px; margin-bottom: 15px; }
        .feature-card h3 { margin-bottom: 10px; font-size: 20px; }
        .feature-card p { font-size: 14px; opacity: 0.9; line-height: 1.6; }
        @media (max-width: 768px) { .features { grid-template-columns: 1fr; } .cert-details { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üéì Certificate Portal</div>
            <div class="nav">
                <a href="index.html">Home</a>
                <span id="user-info" style="color:white;padding:10px 20px;background:rgba(255,255,255,0.2);border-radius:8px;display:none"></span>
                <a href="cert-dashboard.html" id="dashboard-link" style="display:none">Dashboard</a>
                <a href="cert-login.html" id="login-link">Login</a>
                <a href="cert-register.html" id="register-link">Register</a>
                <a href="cert-upload.html" id="upload-link" style="display:none">Upload</a>
                <a href="#" onclick="logout()" id="logout-link" style="display:none">Logout</a>
            </div>
        </div>

        <div class="hero">
            <h1>üéì Verify Your Certificate</h1>
            <p>Enter your certificate ID to search and download your certificate</p>
        </div>

        <div class="search-box">
            <h2>Certificate Verification</h2>
            <p>Enter your unique certificate ID below</p>
            <div class="search-form">
                <input type="text" id="cert-id" placeholder="Enter Certificate ID" />
                <button onclick="searchCertificate()">üîç Search</button>
            </div>
        </div>

        <div id="cert-result" class="cert-result">
            <div class="cert-header">
                <h2>‚úì Certificate Found!</h2>
                <button class="download-btn" onclick="downloadCertificate()">üì• Download PDF</button>
            </div>
            <div class="cert-preview">
                <div class="watermark">VERIFIED</div>
                <div class="cert-content" style="text-align:center">
                    <div class="cert-badge">‚≠ê</div>
                    <div class="cert-title">CERTIFICATE</div>
                    <div class="cert-subtitle">of Completion</div>
                    <div style="width:250px;height:3px;background:linear-gradient(90deg, transparent, #D4AF37, transparent);margin:20px auto"></div>
                    <p class="cert-text" style="font-style:italic;color:#666;">This is to certify that</p>
                    <div id="student-name" class="cert-name">STUDENT NAME</div>
                    <p class="cert-text">has successfully completed the internship program in</p>
                    <div id="domain" class="cert-domain">WEB DEVELOPMENT</div>
                    <p class="cert-text" style="max-width:600px;margin:20px auto;line-height:1.8;">Demonstrating exceptional skills, dedication, and professionalism throughout the internship period. This certificate acknowledges the successful completion of all required tasks and projects.</p>
                    <div class="cert-details">
                        <div>
                            <p><strong>üìÖ Duration</strong><br><span id="duration" style="font-size:15px;color:#555;">1/1/2024 - 3/31/2024</span></p>
                        </div>
                        <div>
                            <p><strong>üÜî Certificate ID</strong><br><span id="cert-id-display" style="font-size:15px;color:#555;font-family:monospace;">CERT001</span></p>
                        </div>
                        <div>
                            <p><strong>üìÜ Issued Date</strong><br><span id="issued-date" style="font-size:15px;color:#555;">4/1/2024</span></p>
                        </div>
                        <div>
                            <p><strong>‚úÖ Status</strong><br><span style="color:#10b981;font-weight:700;font-size:16px;">Verified ‚úì</span></p>
                        </div>
                        <div>
                            <p><strong>üéØ Performance</strong><br><span id="performance" style="font-size:15px;color:#555;">Excellent</span></p>
                        </div>
                        <div>
                            <p><strong>‚≠ê Grade</strong><br><span id="grade" style="font-size:15px;color:#555;font-weight:600;">A+</span></p>
                        </div>
                    </div>
                    <div class="cert-footer">
                        <div class="signature-box">
                            <div class="signature-line"></div>
                            <div class="signature-text"><strong>Authorized Signature</strong><br>Program Director</div>
                        </div>
                        <div class="cert-seal">
                            <div style="text-align:center;line-height:1.2;">OFFICIAL<br>SEAL</div>
                        </div>
                        <div class="qr-code">
                            <div style="text-align:center;">QR<br>CODE</div>
                        </div>
                    </div>
                    <div style="margin-top:30px;padding:15px;background:rgba(102,126,234,0.1);border-radius:8px;">
                        <p style="font-size:12px;color:#666;margin:0;">üîí This certificate is digitally verified and can be authenticated at certificate.jobportal.com</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="error-box" class="error-box">
            <h3>‚ùå Certificate Not Found</h3>
            <p>Please check your certificate ID and try again.</p>
        </div>

        <div class="features">
            <div class="feature-card">
                <div class="feature-icon">‚ö°</div>
                <h3>Instant Verification</h3>
                <p>Verify certificates in real-time with blockchain technology</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üîí</div>
                <h3>Secure & Authentic</h3>
                <p>Military-grade encryption and tamper-proof records</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üì•</div>
                <h3>Easy Download</h3>
                <p>Download high-quality PDF certificates anytime</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üåê</div>
                <h3>Global Recognition</h3>
                <p>Accepted by employers worldwide</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üìä</div>
                <h3>Performance Tracking</h3>
                <p>Detailed performance metrics and grades</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üèÜ</div>
                <h3>Professional Design</h3>
                <p>Industry-standard certificate templates</p>
            </div>
        </div>
    </div>

    <script>
        let currentCert = null;

        // Check login status on page load
        window.addEventListener('load', () => {
            const user = JSON.parse(localStorage.getItem('user') || 'null');
            const token = localStorage.getItem('authToken');
            
            if (user && token) {
                document.getElementById('user-info').textContent = `üë§ ${user.name} (${user.role})`;
                document.getElementById('user-info').style.display = 'inline-block';
                document.getElementById('login-link').style.display = 'none';
                document.getElementById('register-link').style.display = 'none';
                document.getElementById('logout-link').style.display = 'inline-block';
                
                if (user.role === 'admin') {
                    document.getElementById('upload-link').style.display = 'inline-block';
                    document.getElementById('dashboard-link').style.display = 'inline-block';
                }
            }
        });

        function logout() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('user');
            alert('‚úì Logged out successfully!');
            location.reload();
        }

        async function searchCertificate() {
            const certId = document.getElementById('cert-id').value.trim();
            if (!certId) {
                alert('‚ö†Ô∏è Please enter a certificate ID');
                return;
            }

            console.log('Searching for:', certId);

            try {
                const response = await fetch(`http://localhost:3001/api/certificates/search/${certId}`);
                console.log('Response status:', response.status);
                
                const data = await response.json();
                console.log('Response data:', data);

                if (data.success && data.certificate) {
                    currentCert = data.certificate;
                    displayCertificate(data.certificate);
                } else {
                    showError(data.message || 'Certificate not found');
                }
            } catch (error) {
                console.error('Error:', error);
                showError('Backend not running. Please start backend: cd backend && npm start');
            }
        }

        function displayCertificate(cert) {
            document.getElementById('cert-result').style.display = 'block';
            document.getElementById('error-box').style.display = 'none';

            document.getElementById('student-name').textContent = cert.studentName.toUpperCase();
            document.getElementById('domain').textContent = cert.internshipDomain.toUpperCase();
            document.getElementById('duration').textContent = 
                `${new Date(cert.startDate).toLocaleDateString('en-US', {month: 'long', day: 'numeric', year: 'numeric'})} - ${new Date(cert.endDate).toLocaleDateString('en-US', {month: 'long', day: 'numeric', year: 'numeric'})}`;
            document.getElementById('cert-id-display').textContent = cert.certificateId;
            document.getElementById('issued-date').textContent = 
                new Date(cert.issuedDate || cert.createdAt).toLocaleDateString('en-US', {month: 'long', day: 'numeric', year: 'numeric'});
            
            // Add performance and grade (you can customize based on your data)
            const performance = cert.performance || 'Excellent';
            const grade = cert.grade || 'A+';
            document.getElementById('performance').textContent = performance;
            document.getElementById('grade').textContent = grade;

            document.getElementById('cert-result').scrollIntoView({ behavior: 'smooth' });
        }

        function showError(message) {
            document.getElementById('cert-result').style.display = 'none';
            document.getElementById('error-box').style.display = 'block';
            document.getElementById('error-box').querySelector('p').textContent = message;
            document.getElementById('error-box').scrollIntoView({ behavior: 'smooth' });
        }

        async function downloadCertificate() {
            if (!currentCert) return;

            try {
                const response = await fetch(`http://localhost:3001/api/certificates/download/${currentCert.certificateId}`);
                const blob = await response.blob();

                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `certificate-${currentCert.certificateId}.pdf`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);

                alert('‚úì Certificate downloaded successfully!');
            } catch (error) {
                console.error('Download error:', error);
                alert('‚ùå Download failed. Please try again.');
            }
        }
    </script>
</body>
</html>