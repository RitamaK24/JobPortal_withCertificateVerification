<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Portal - My Dashboard</title>
    <link rel="stylesheet" href="script/styles/premium-cert.css">
    <style>
        .portal-container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .welcome-section { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 12px; margin-bottom: 30px; }
        .features-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .feature-box { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center; }
        .feature-icon { font-size: 48px; margin-bottom: 15px; }
        .cert-list { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .cert-item { display: flex; justify-content: between; align-items: center; padding: 15px; border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 10px; }
        .cert-info { flex: 1; }
        .cert-actions { display: flex; gap: 10px; }
        .btn { padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer; text-decoration: none; display: inline-block; }
        .btn-primary { background: #667eea; color: white; }
        .btn-secondary { background: #f3f4f6; color: #374151; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 8px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .stat-number { font-size: 32px; font-weight: bold; color: #667eea; }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>
    
    <header class="premium-header">
        <nav class="nav-container">
            <div class="logo-section">
                <span class="logo-text">Student Portal</span>
            </div>
            <div class="nav-menu">
                <span id="studentWelcome"></span>
                <button onclick="logout()" class="nav-link-btn">Logout</button>
            </div>
        </nav>
    </header>

    <main class="portal-container">
        <section class="welcome-section">
            <h1>Welcome to Your Dashboard</h1>
            <p id="welcomeMessage">Manage your certificates, track progress, and download documents</p>
        </section>

        <section class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalCerts">0</div>
                <div>Total Certificates</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="activeCerts">0</div>
                <div>Active Certificates</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="downloadCount">0</div>
                <div>Downloads</div>
            </div>
        </section>

        <section class="features-grid">
            <div class="feature-box">
                <div class="feature-icon">üìú</div>
                <h3>My Certificates</h3>
                <p>View and download all your certificates</p>
                <button onclick="loadMyCertificates()" class="btn btn-primary">View Certificates</button>
            </div>
            
            <div class="feature-box">
                <div class="feature-icon">üîç</div>
                <h3>Verify Certificate</h3>
                <p>Verify any certificate by ID</p>
                <a href="certificate-premium.html" class="btn btn-primary">Verify Now</a>
            </div>
            
            <div class="feature-box">
                <div class="feature-icon">üìä</div>
                <h3>Progress Tracking</h3>
                <p>Track your learning progress</p>
                <button onclick="showProgress()" class="btn btn-primary">View Progress</button>
            </div>
            
            <div class="feature-box">
                <div class="feature-icon">üìß</div>
                <h3>Share Certificates</h3>
                <p>Share certificates on social media</p>
                <button onclick="shareOptions()" class="btn btn-primary">Share</button>
            </div>
            
            <div class="feature-box">
                <div class="feature-icon">üì±</div>
                <h3>Mobile App</h3>
                <p>Download our mobile app</p>
                <button onclick="downloadApp()" class="btn btn-secondary">Coming Soon</button>
            </div>
            
            <div class="feature-box">
                <div class="feature-icon">üíº</div>
                <h3>Job Applications</h3>
                <p>Apply for jobs with certificates</p>
                <a href="index.html" class="btn btn-primary">Browse Jobs</a>
            </div>
        </section>

        <section class="cert-list" id="certificatesSection" style="display: none;">
            <h3>My Certificates</h3>
            <div id="certificatesList">
                <!-- Certificates will be loaded here -->
            </div>
        </section>
    </main>

    <script src="script/auth.js"></script>
    <script>
        const API_BASE_URL = 'http://localhost:3001/api';
        let studentInfo = null;

        // Check if student is logged in
        function checkLogin() {
            if (!auth.requireAuth('student')) {
                return;
            }
            
            studentInfo = auth.getUserData();
            document.getElementById('studentWelcome').textContent = `Hello, ${studentInfo.studentName}`;
            document.getElementById('welcomeMessage').textContent = `Welcome back, ${studentInfo.studentName}! Here's your dashboard overview.`;
        }

        // Logout
        function logout() {
            auth.clearSession();
            window.location.href = 'student-login.html';
        }

        // Load student's certificates
        async function loadMyCertificates() {
            if (!studentInfo) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/certificates/student/${encodeURIComponent(studentInfo.studentName)}`);
                const data = await response.json();
                
                if (data.success) {
                    displayCertificates(data.certificates);
                    updateStats(data.certificates);
                    document.getElementById('certificatesSection').style.display = 'block';
                } else {
                    document.getElementById('certificatesList').innerHTML = '<p>No certificates found.</p>';
                    document.getElementById('certificatesSection').style.display = 'block';
                }
            } catch (error) {
                alert('Error loading certificates');
            }
        }

        // Display certificates
        function displayCertificates(certificates) {
            const container = document.getElementById('certificatesList');
            container.innerHTML = '';
            
            certificates.forEach(cert => {
                const certDiv = document.createElement('div');
                certDiv.className = 'cert-item';
                certDiv.innerHTML = `
                    <div class="cert-info">
                        <h4>${cert.internshipDomain}</h4>
                        <p><strong>ID:</strong> ${cert.certificateId}</p>
                        <p><strong>Duration:</strong> ${new Date(cert.startDate).toLocaleDateString()} - ${new Date(cert.endDate).toLocaleDateString()}</p>
                    </div>
                    <div class="cert-actions">
                        <button class="btn btn-primary" onclick="downloadCert('${cert.certificateId}')">Download</button>
                        <button class="btn btn-secondary" onclick="shareCert('${cert.certificateId}')">Share</button>
                        <button class="btn btn-secondary" onclick="verifyCert('${cert.certificateId}')">Verify</button>
                    </div>
                `;
                container.appendChild(certDiv);
            });
        }

        // Update statistics
        function updateStats(certificates) {
            document.getElementById('totalCerts').textContent = certificates.length;
            document.getElementById('activeCerts').textContent = certificates.filter(c => c.isActive).length;
            document.getElementById('downloadCount').textContent = certificates.length * 2; // Mock data
        }

        // Download certificate
        async function downloadCert(certificateId) {
            try {
                const response = await fetch(`${API_BASE_URL}/certificates/download/${certificateId}`);
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `certificate-${certificateId}.pdf`;
                    a.click();
                    window.URL.revokeObjectURL(url);
                }
            } catch (error) {
                alert('Error downloading certificate');
            }
        }

        // Share certificate
        function shareCert(certificateId) {
            const shareUrl = `${window.location.origin}/certificate-premium.html?id=${certificateId}`;
            if (navigator.share) {
                navigator.share({
                    title: 'My Certificate',
                    text: 'Check out my certificate!',
                    url: shareUrl
                });
            } else {
                navigator.clipboard.writeText(shareUrl);
                alert('Certificate link copied to clipboard!');
            }
        }

        // Verify certificate
        function verifyCert(certificateId) {
            window.open(`certificate-premium.html?id=${certificateId}`, '_blank');
        }

        // Show progress
        function showProgress() {
            alert('Progress tracking feature coming soon!');
        }

        // Share options
        function shareOptions() {
            alert('Social media sharing coming soon!');
        }

        // Download app
        function downloadApp() {
            alert('Mobile app coming soon!');
        }

        // Logout
        function logout() {
            auth.clearSession();
            window.location.href = 'student-login.html';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkLogin();
            loadMyCertificates();
        });
    </script>
</body>
</html>