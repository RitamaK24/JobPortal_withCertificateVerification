<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - My Certificates</title>
    <link rel="stylesheet" href="script/styles/premium-cert.css">
    <style>
        .dashboard-container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .cert-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 30px; }
        .cert-item { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .cert-item h3 { color: #667eea; margin-bottom: 10px; }
        .cert-actions { display: flex; gap: 10px; margin-top: 15px; }
        .btn-small { padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer; font-size: 14px; }
        .btn-primary { background: #667eea; color: white; }
        .btn-secondary { background: #f3f4f6; color: #374151; }
        .search-section { margin-bottom: 30px; }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>
    
    <header class="premium-header">
        <nav class="nav-container">
            <div class="logo-section">
                <div class="logo-circle">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                        <path d="M16 2L20 12L30 16L20 20L16 30L12 20L2 16L12 12L16 2Z" fill="url(#logo-gradient)"/>
                        <defs>
                            <linearGradient id="logo-gradient" x1="2" y1="2" x2="30" y2="30">
                                <stop offset="0%" stop-color="#667eea"/>
                                <stop offset="100%" stop-color="#764ba2"/>
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <span class="logo-text">My Certificates</span>
            </div>
            <div class="nav-menu">
                <a href="certificate-premium.html" class="nav-link">Verify Certificate</a>
                <a href="certify-home.html" class="nav-link">Home</a>
            </div>
        </nav>
    </header>

    <main class="dashboard-container">
        <section class="hero">
            <h1 class="hero-title">My Certificate Dashboard</h1>
            <p class="hero-description">View, download, and manage all your certificates in one place</p>
        </section>

        <section class="search-section">
            <div class="search-wrapper">
                <div class="search-box">
                    <input type="text" id="studentName" placeholder="Enter your full name to find certificates" class="search-input">
                    <button onclick="searchStudentCertificates()" class="search-btn-premium">
                        <span>Find My Certificates</span>
                    </button>
                </div>
            </div>
        </section>

        <div id="certificates-grid" class="cert-grid" style="display: none;">
            <!-- Certificates will be loaded here -->
        </div>

        <div id="no-certificates" class="error-section hidden">
            <div class="error-container">
                <h3>No Certificates Found</h3>
                <p>We couldn't find any certificates for this name. Please check the spelling and try again.</p>
            </div>
        </div>
    </main>

    <script>
        const API_BASE_URL = 'http://localhost:3001/api';

        async function searchStudentCertificates() {
            const studentName = document.getElementById('studentName').value.trim();
            
            if (!studentName) {
                alert('Please enter your name');
                return;
            }

            try {
                // Since we don't have a direct API for student name search, 
                // we'll need to add this functionality to backend
                const response = await fetch(`${API_BASE_URL}/certificates/student/${encodeURIComponent(studentName)}`);
                const data = await response.json();

                if (data.success && data.certificates.length > 0) {
                    displayCertificates(data.certificates);
                    document.getElementById('no-certificates').classList.add('hidden');
                } else {
                    document.getElementById('certificates-grid').style.display = 'none';
                    document.getElementById('no-certificates').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error searching certificates. Please try again.');
            }
        }

        function displayCertificates(certificates) {
            const grid = document.getElementById('certificates-grid');
            grid.innerHTML = '';
            
            certificates.forEach(cert => {
                const certItem = document.createElement('div');
                certItem.className = 'cert-item';
                certItem.innerHTML = `
                    <h3>${cert.internshipDomain}</h3>
                    <p><strong>Certificate ID:</strong> ${cert.certificateId}</p>
                    <p><strong>Duration:</strong> ${new Date(cert.startDate).toLocaleDateString()} - ${new Date(cert.endDate).toLocaleDateString()}</p>
                    <p><strong>Issued:</strong> ${new Date(cert.issuedDate).toLocaleDateString()}</p>
                    <div class="cert-actions">
                        <button class="btn-small btn-primary" onclick="downloadCert('${cert.certificateId}')">Download PDF</button>
                        <button class="btn-small btn-secondary" onclick="viewCert('${cert.certificateId}')">View Details</button>
                    </div>
                `;
                grid.appendChild(certItem);
            });
            
            grid.style.display = 'grid';
        }

        async function downloadCert(certificateId) {
            try {
                const response = await fetch(`${API_BASE_URL}/certificates/download/${certificateId}`);
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `certificate-${certificateId}.pdf`;
                    a.click();
                    window.URL.revokeObjectURL(url);
                }
            } catch (error) {
                alert('Error downloading certificate');
            }
        }

        function viewCert(certificateId) {
            window.open(`certificate-premium.html?id=${certificateId}`, '_blank');
        }
    </script>
</body>
</html>